<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button> 
    </ion-buttons>
    <ion-title>Login</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding ion-text-center">
  
  <ion-card class="login-card">
    <ion-card-header>
      <ion-card-title>Bem-vindo(a) de volta!</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <!-- #loginForm="ngForm" é a referência ao formulário -->
      <form (ngSubmit)="onLogin()" #loginForm="ngForm">
        
        <!-- Input de E-mail -->
        <ion-item>
          <ion-label position="floating">E-mail</ion-label>
          <ion-input 
            type="email" 
            [(ngModel)]="credentials.email" <!-- Usando 'credentials' -->
            name="email"
            required
            email
            #email="ngModel"/> <!-- CORRIGIDO: Agora usando auto-fechamento -->
        </ion-item>
        <div class="validation-error" *ngIf="email.invalid && (email.dirty || email.touched)">
          <div *ngIf="email.errors?.['required']">O e-mail é obrigatório.</div>
          <div *ngIf="email.errors?.['email']">Por favor, insira um e-mail válido.</div>
        </div>

        <!-- Input de Senha -->
        <ion-item>
          <ion-label position="floating">Senha</ion-label>
          <ion-input 
            [type]="isPasswordVisible ? 'text' : 'password'" 
            [(ngModel)]="credentials.password" <!-- Usando 'credentials' -->
            name="password"
            required
            minlength="6"
            #password="ngModel"/> <!-- CORRIGIDO: Agora usando auto-fechamento -->
          <ion-icon 
            slot="end" 
            [name]="isPasswordVisible ? 'eye-outline' : 'eye-off-outline'"
            (click)="togglePasswordVisibility()">
          </ion-icon>
        </ion-item>
        <div class="validation-error" *ngIf="password.invalid && (password.dirty || password.touched)">
          <div *ngIf="password.errors?.['required']">A senha é obrigatória.</div>
          <div *ngIf="password.errors?.['minlength']">A senha deve ter no mínimo 6 caracteres.</div>
        </div>
        
        <!-- O [disabled] usa a referência do formulário, que é loginForm -->
        <ion-button 
            expand="block" 
            type="submit" 
            class="ion-margin-top"
            [disabled]="loginForm.invalid"> Entrar
        </ion-button>
      </form>

      <p class="ion-margin-top">
        <a [routerLink]="['/forgot-password']">Esqueci minha senha</a>
      </p>

      <p>
        Se não tem uma conta, <a routerLink="/register">crie uma aqui</a>.
      </p>

    </ion-card-content>
  </ion-card>
</ion-content>