<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Notificações
      @if (unreadCount > 0) {
        <ion-badge color="danger">{{ unreadCount }}</ion-badge>
      }
    </ion-title>
    @if (notifications.length > 0) {
      <ion-button slot="end" fill="clear" size="small" (click)="markAllAsRead()">
        Ler todas
      </ion-button>
    }
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Notificações</ion-title>
    </ion-toolbar>
  </ion-header>

  @if (loading) {
    <div class="loading-container">
      <p>Carregando notificações...</p>
    </div>
  } @else if (notifications.length > 0) {
    <ion-list>
      @for (notif of notifications; track notif.id) {
        <ion-item 
          [class.unread]="!notif.read"
          (click)="goToPost(notif)"
          button
        >
          <ion-thumbnail slot="start">
            <img [src]="notif.bookImage" alt="Capa do livro"/>
          </ion-thumbnail>
          
          <ion-label>
            <div class="notification-header">
              <img 
                class="user-avatar" 
                [src]="notif.triggeredByAvatar" 
                [alt]="notif.triggeredByUsername"
              />
              <div class="notification-content">
                <p class="notification-message">
                  {{ getNotificationMessage(notif) }}
                </p>
                <p class="notification-time">
                  {{ formatDate(notif.createdAt) }}
                </p>
              </div>
            </div>
          </ion-label>

          <ion-icon 
            slot="end" 
            [name]="getNotificationIcon(notif)" 
            [color]="getNotificationColor(notif)"
          ></ion-icon>
        </ion-item>
      }
    </ion-list>
  } @else {
    <div class="empty-state">
      <ion-icon name="notifications-outline" size="large"></ion-icon>
      <h2>Sem notificações</h2>
      <p>Você ainda não recebeu nenhuma notificação.</p>
    </div>
  }
</ion-content>